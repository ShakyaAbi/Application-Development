@page "/timeline"
@inject IStorageService Storage
@inject NavigationManager Navigation
@inject IAuthenticationService AuthService
@using System.Text.RegularExpressions
@using Courcework.Enums
@using System.Linq

<MudStack Spacing="4" Class="page-stack">
    <div class="timeline-header">
        <MudText Typo="Typo.h5"><strong>Timeline</strong></MudText>
        <MudText Typo="Typo.body2" Class="muted">Browse and search your journal entries</MudText>
    </div>

    <!-- Search Section -->
    <MudPaper Class="filters-paper" Elevation="3">
        <MudStack Spacing="3">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.Search" Size="Size.Medium" />
                <MudText Typo="Typo.h6"><strong>Search Entries</strong></MudText>
            </MudStack>
            
            <MudTextField T="string" 
                         Value="@_searchTerm"
                         ValueChanged="@OnSearchChanged"
                         Label="Search" 
                         Placeholder="Title or content" 
                         Variant="Variant.Outlined"
                         FullWidth="true"
                         Clearable="true"
                         OnClearButtonClick="@ClearSearch" />
        </MudStack>
    </MudPaper>

    <!-- Filters Section -->
    <MudPaper Class="filters-paper" Elevation="3">
        <MudStack Spacing="3">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.FilterList" Size="Size.Medium" />
                <MudText Typo="Typo.h6"><strong>Filter Entries</strong></MudText>
                <MudSpacer />
                @if (_hasActiveFilters)
                {
                    <MudButton Variant="Variant.Text" 
                               Color="Color.Error" 
                               Size="Size.Small"
                               StartIcon="@Icons.Material.Filled.ClearAll"
                               OnClick="@ResetFilters">
                        Clear Filters
                    </MudButton>
                }
            </MudStack>

            <!-- Filter Controls Row -->
            <MudStack Spacing="3">
                <!-- Mood Filter -->
                <MudStack Spacing="2">
                    <MudText Typo="Typo.body2"><strong>Mood (@_availableMoods.Count)</strong></MudText>
                    @if (_availableMoods?.Count > 0)
                    {
                        <MudStack Row="true" Spacing="1" Wrap="Wrap.Wrap">
                            @foreach (var mood in _availableMoods.OrderBy(m => m))
                            {
                                <MudButton Variant="@(_selectedMood == mood ? Variant.Filled : Variant.Outlined)" 
                                           Color="Color.Primary" 
                                           Size="Size.Small"
                                           OnClick="@(async () => { _selectedMood = _selectedMood == mood ? "" : mood; await ApplyFilters(); })">
                                    @mood
                                </MudButton>
                            }
                            @if (!string.IsNullOrEmpty(_selectedMood))
                            {
                                <MudButton Variant="Variant.Text" 
                                           Color="Color.Default" 
                                           Size="Size.Small"
                                           OnClick="@(async () => { _selectedMood = ""; await ApplyFilters(); })">
                                    Clear
                                </MudButton>
                            }
                        </MudStack>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2" Class="muted">No moods in database</MudText>
                    }
                </MudStack>

                <!-- Secondary Mood Filter -->
                <MudStack Spacing="2">
                    <MudText Typo="Typo.body2"><strong>Secondary Mood (@_availableSecondaryMoods.Count)</strong></MudText>
                    @if (_availableSecondaryMoods?.Count > 0)
                    {
                        <MudStack Row="true" Spacing="1" Wrap="Wrap.Wrap">
                            @foreach (var mood in _availableSecondaryMoods.OrderBy(m => m))
                            {
                                <MudButton Variant="@(_selectedSecondaryMood == mood ? Variant.Filled : Variant.Outlined)" 
                                           Color="Color.Secondary" 
                                           Size="Size.Small"
                                           OnClick="@(async () => { _selectedSecondaryMood = _selectedSecondaryMood == mood ? "" : mood; await ApplyFilters(); })">
                                    @mood
                                </MudButton>
                            }
                            @if (!string.IsNullOrEmpty(_selectedSecondaryMood))
                            {
                                <MudButton Variant="Variant.Text" 
                                           Color="Color.Default" 
                                           Size="Size.Small"
                                           OnClick="@(async () => { _selectedSecondaryMood = ""; await ApplyFilters(); })">
                                    Clear
                                </MudButton>
                            }
                        </MudStack>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2" Class="muted">No secondary moods</MudText>
                    }
                </MudStack>

                <!-- Tags Filter -->
                <MudStack Spacing="2">
                    <MudText Typo="Typo.body2"><strong>Tags (@_availableTags.Count)</strong></MudText>
                    @if (_availableTags?.Count > 0)
                    {
                        <MudStack Row="true" Spacing="1" Wrap="Wrap.Wrap">
                            @foreach (var tag in _availableTags.OrderBy(t => t.Name))
                            {
                                <MudButton Variant="@(_selectedTag == tag.Name ? Variant.Filled : Variant.Outlined)" 
                                           Color="Color.Info" 
                                           Size="Size.Small"
                                           OnClick="@(async () => { _selectedTag = _selectedTag == tag.Name ? "" : tag.Name; await ApplyFilters(); })">
                                    @tag.Name
                                </MudButton>
                            }
                            @if (!string.IsNullOrEmpty(_selectedTag))
                            {
                                <MudButton Variant="Variant.Text" 
                                           Color="Color.Default" 
                                           Size="Size.Small"
                                           OnClick="@(async () => { _selectedTag = ""; await ApplyFilters(); })">
                                    Clear
                                </MudButton>
                            }
                        </MudStack>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2" Class="muted">No tags available</MudText>
                    }
                </MudStack>

                <!-- Date Range Filter -->
                <MudStack Spacing="2">
                    <MudText Typo="Typo.body2"><strong>Date Range</strong></MudText>
                    <MudButton Variant="Variant.Outlined" 
                               Size="Size.Small"
                               FullWidth="false"
                               OnClick="@ToggleDatePicker"
                               StartIcon="@Icons.Material.Filled.DateRange">
                        @if (_showDatePicker)
                        {
                            <span>@_startDate?.ToString("MMM dd") - @_endDate?.ToString("MMM dd")</span>
                        }
                        else
                        {
                            <span>Select Dates</span>
                        }
                    </MudButton>
                </MudStack>
            </MudStack>

            <!-- Date Picker (Collapsible) -->
            @if (_showDatePicker)
            {
                <MudDivider Class="my-2" />
                <MudStack Row="true" Spacing="2" AlignItems="AlignItems.End">
                    <MudTextField T="string"
                                  Value="@_startDate?.ToString("yyyy-MM-dd")"
                                  ValueChanged="@(async (string v) => await OnStartDateTextChanged(v))"
                                  Label="Start Date"
                                  Placeholder="yyyy-MM-dd"
                                  Variant="Variant.Outlined"
                                  Margin="Margin.Dense" />
                    <MudTextField T="string"
                                  Value="@_endDate?.ToString("yyyy-MM-dd")"
                                  ValueChanged="@(async (string v) => await OnEndDateTextChanged(v))"
                                  Label="End Date"
                                  Placeholder="yyyy-MM-dd"
                                  Variant="Variant.Outlined"
                                  Margin="Margin.Dense" />
                    <MudButton Variant="Variant.Text"
                               Color="Color.Secondary"
                               Size="Size.Small"
                               OnClick="@ToggleDatePicker">
                        Done
                    </MudButton>
                </MudStack>
            }

            <!-- Active Filters Display -->
            @if (_hasActiveFilters)
            {
                <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center" Wrap="Wrap.Wrap">
                    <MudText Typo="Typo.caption" Class="filter-label">Active filters:</MudText>
                    @if (!string.IsNullOrEmpty(_selectedMood))
                    {
                        <MudChip T="string" Color="Color.Primary" OnClose="@(async () => { _selectedMood = ""; await ApplyFilters(); })">
                            Mood: @_selectedMood
                        </MudChip>
                    }
                    @if (!string.IsNullOrEmpty(_selectedSecondaryMood))
                    {
                        <MudChip T="string" Color="Color.Secondary" OnClose="@(async () => { _selectedSecondaryMood = ""; await ApplyFilters(); })">
                            Secondary: @_selectedSecondaryMood
                        </MudChip>
                    }
                    @if (!string.IsNullOrEmpty(_selectedTag))
                    {
                        <MudChip T="string" Color="Color.Info" OnClose="@(async () => { _selectedTag = ""; await ApplyFilters(); })">
                            Tag: @_selectedTag
                        </MudChip>
                    }
                    @if (_startDate.HasValue || _endDate.HasValue)
                    {
                        <MudChip T="string" Color="Color.Warning" OnClose="@(async () => { _startDate = null; _endDate = null; await ApplyFilters(); })">
                            Dates: @_startDate?.ToString("MMM dd") - @_endDate?.ToString("MMM dd")
                        </MudChip>
                    }
                </MudStack>
            }
        </MudStack>
    </MudPaper>

    <!-- Results Info -->
    @if (_hasActiveFilters || !string.IsNullOrEmpty(_searchTerm))
    {
        <MudText Typo="Typo.body2" Class="muted">
            Found @_displayEntries.Count entry(@(_displayEntries.Count != 1 ? "ies" : ""))
            @if (!string.IsNullOrEmpty(_searchTerm))
            {
                <span>matching "@_searchTerm"</span>
            }
            @if (_hasActiveFilters)
            {
                <span>with active filters</span>
            }
        </MudText>
    }

    <!-- Entry Cards Grid -->
    @if (_displayEntries.Count == 0)
    {
        <MudAlert Severity="Severity.Info" Variant="Variant.Filled">
            @if (string.IsNullOrEmpty(_searchTerm) && !_hasActiveFilters)
            {
                <span>No entries yet. Start journaling in the <strong>Today</strong> section!</span>
            }
            else if (_hasActiveFilters || !string.IsNullOrEmpty(_searchTerm))
            {
                <span>No entries found matching your search or filters. Try adjusting your criteria.</span>
            }
        </MudAlert>
    }
    else
    {
        <MudGrid Spacing="3" Class="entries-grid">
            @foreach (var entry in _displayEntries)
            {
                <MudItem xs="12" sm="12" md="4" lg="4">
                    <MudPaper Class="entry-card" Elevation="3">
                        <MudStack Spacing="3" Style="height: 100%;">
                            <!-- Header -->
                            <div>
                                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Wrap="Wrap.Wrap">
                                    <MudText Typo="Typo.subtitle2"><strong>@entry.Date.ToString("MMM dd, yyyy")</strong></MudText>
                                    @if (entry.Mood.HasValue)
                                    {
                                        <MudChip T="string" Value="@entry.Mood.Value.ToString()" Color="Color.Primary" Variant="Variant.Filled" Size="Size.Small">
                                            @entry.Mood.Value.ToString()
                                        </MudChip>
                                    }
                                    @if (!string.IsNullOrEmpty(entry.SecondaryMood))
                                    {
                                        <MudChip T="string" Value="@entry.SecondaryMood" Color="Color.Secondary" Variant="Variant.Filled" Size="Size.Small">
                                            @entry.SecondaryMood
                                        </MudChip>
                                    }
                                </MudStack>
                            </div>

                            <!-- Tags Display -->
                            @if (entry.Tags.Count > 0)
                            {
                                <div>
                                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center" Wrap="Wrap.Wrap">
                                        <MudIcon Icon="@Icons.Material.Filled.Tag" Size="Size.Small" Class="muted" />
                                        @foreach (var tag in entry.Tags)
                                        {
                                            <MudChip T="string" Value="@tag" Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary">
                                                @tag
                                            </MudChip>
                                        }
                                    </MudStack>
                                </div>
                            }

                            <!-- Title and Preview -->
                            <div>
                                <MudText Typo="Typo.h6" Class="truncate">
                                    <strong>@(string.IsNullOrEmpty(entry.Title) ? "Untitled" : entry.Title)</strong>
                                </MudText>
                                <MudText Typo="Typo.body2" Class="muted entry-snippet">
                                    @GetPreview(entry.Content)
                                </MudText>
                            </div>

                            <!-- Category and Word Count -->
                            <div>
                                @if (!string.IsNullOrEmpty(entry.Category))
                                {
                                    <MudText Typo="Typo.caption" Class="muted">
                                        <strong>Category:</strong> @entry.Category
                                    </MudText>
                                }
                                <MudText Typo="Typo.caption" Class="muted">
                                    <strong>Words:</strong> @GetWordCount(entry.Content)
                                </MudText>
                            </div>

                            <!-- Spacer -->
                            <MudSpacer />

                            <!-- Footer -->
                            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="footer-section">
                                <MudButton Variant="Variant.Text" 
                                          Size="Size.Small" 
                                          Color="Color.Primary" 
                                          Class="open-button"
                                          OnClick="@(() => ViewEntry(entry.Date))">
                                    View Entry
                                </MudButton>
                                <MudText Typo="Typo.caption" Class="muted">@GetTimeAgo(entry.UpdatedAt)</MudText>
                            </MudStack>
                        </MudStack>
                    </MudPaper>
                </MudItem>
            }
        </MudGrid>
    }
</MudStack>

@code {
    private string _searchTerm = "";
    private string _selectedMood = "";
    private string _selectedSecondaryMood = "";
    private string _selectedTag = "";
    private DateTime? _startDate = null;
    private DateTime? _endDate = null;
    private bool _showDatePicker = false;

    private List<JournalEntry> _allEntries = new();
    private List<JournalEntry> _displayEntries = new();
    private List<Tag> _availableTags = new();
    private List<string> _availableMoods = new();
    private List<string> _availableSecondaryMoods = new();

    private bool _hasActiveFilters => !string.IsNullOrEmpty(_selectedMood) || 
                                      !string.IsNullOrEmpty(_selectedSecondaryMood) ||
                                      !string.IsNullOrEmpty(_selectedTag) ||
                                      _startDate.HasValue ||
                                      _endDate.HasValue;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // ✅ CHECK AUTHENTICATION - MUST BE LOGGED IN
            var currentUser = await AuthService.GetCurrentUserAsync();
            if (currentUser == null)
            {
                Navigation.NavigateTo("/login");
                return;
            }

            System.Diagnostics.Debug.WriteLine("=== TIMELINE LOADING STARTING ===");
            
            await Storage.InitializeAsync();
            System.Diagnostics.Debug.WriteLine("✓ Storage initialized");
            
            await LoadAllEntries();
            System.Diagnostics.Debug.WriteLine($"✓ Entries loaded: {_allEntries.Count} total");
            
            // Debug: Show ALL entries with their mood values
            foreach (var entry in _allEntries.Take(5))
            {
                System.Diagnostics.Debug.WriteLine($"  - Entry {entry.Date}: Mood='{entry.Mood}', Secondary='{entry.SecondaryMood}'");
            }
            
            await LoadAvailableTags();
            System.Diagnostics.Debug.WriteLine($"✓ Tags loaded: {_availableTags.Count}");
            
            await LoadAvailableMoods();
            System.Diagnostics.Debug.WriteLine($"✓ MOODS LOADED - Primary: {_availableMoods.Count}, Secondary: {_availableSecondaryMoods.Count}");
            
            if (_availableMoods.Count == 0)
            {
                System.Diagnostics.Debug.WriteLine("⚠️ WARNING: No moods found! Check if entries have mood values in the database.");
            }
            
            System.Diagnostics.Debug.WriteLine("=== TIMELINE LOADING COMPLETE ===\n");
            StateHasChanged();
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($"✗ CRITICAL ERROR in OnInitializedAsync: {ex.Message}\n{ex.StackTrace}");
        }
    }

    private async Task LoadAllEntries()
    {
        try
        {
            var result = await Storage.GetAllEntriesAsync();
            
            if (result.Success && result.Data != null)
            {
                _allEntries = result.Data;
                _displayEntries = _allEntries.OrderByDescending(e => e.Date).ToList();
                
                // Debug mood values
                var entriesWithMood = _allEntries.Where(e => e.Mood.HasValue).Count();
                System.Diagnostics.Debug.WriteLine($"  Entries with Mood: {entriesWithMood}/{_allEntries.Count}");
            }
            else
            {
                _allEntries = new();
                _displayEntries = new();
                System.Diagnostics.Debug.WriteLine($"✗ GetAllEntriesAsync failed: {result?.ErrorMessage}");
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($"✗ LoadAllEntries exception: {ex.Message}");
            _allEntries = new();
            _displayEntries = new();
        }
    }

    private async Task LoadAvailableTags()
    {
        try
        {
            var result = await Storage.GetAllTagsAsync();
            if (result.Success)
            {
                _availableTags = result.Data ?? new();
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($"✗ LoadAvailableTags error: {ex.Message}");
            _availableTags = new();
        }
    }

    
    /// Load unique moods from all journal entries in the database
    
    private async Task LoadAvailableMoods()
    {
        try
        {
            System.Diagnostics.Debug.WriteLine($"Loading moods from {_allEntries.Count} entries");
            
            // Get all unique primary moods from entries (enum values)
            _availableMoods = _allEntries
                .Where(e => e.Mood.HasValue)
                .Select(e => e.Mood.Value.ToString())
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .OrderBy(m => m)
                .ToList();

            // Get all unique secondary moods from entries
            _availableSecondaryMoods = _allEntries
                .Where(e => !string.IsNullOrEmpty(e.SecondaryMood))
                .Select(e => e.SecondaryMood!)
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .OrderBy(m => m)
                .ToList();
                
            if (_availableMoods.Count > 0)
            {
                System.Diagnostics.Debug.WriteLine($"  Primary moods found: {string.Join(", ", _availableMoods)}");
            }
            else
            {
                System.Diagnostics.Debug.WriteLine("  ⚠️ No primary moods found!");
            }
            
            if (_availableSecondaryMoods.Count > 0)
            {
                System.Diagnostics.Debug.WriteLine($"  Secondary moods found: {string.Join(", ", _availableSecondaryMoods)}");
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($"✗ LoadAvailableMoods error: {ex.Message}");
            _availableMoods = new();
            _availableSecondaryMoods = new();
        }
    }

    private async Task OnSearchChanged(string value)
    {
        _searchTerm = value ?? "";
        await ApplyFilters();
    }

    private async Task OnStartDateTextChanged(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            _startDate = null;
        }
        else if (DateTime.TryParse(value, out var date))
        {
            _startDate = date;
        }
        await ApplyFilters();
    }

    private async Task OnEndDateTextChanged(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            _endDate = null;
        }
        else if (DateTime.TryParse(value, out var date))
        {
            _endDate = date;
        }
        await ApplyFilters();
    }

    private async Task ApplyFilters()
    {
        var filtered = new List<JournalEntry>(_allEntries);

        // Apply search term
        if (!string.IsNullOrWhiteSpace(_searchTerm))
        {
            var searchLower = _searchTerm.ToLower();
            filtered = filtered.Where(e =>
            {
                var titleMatch = e.Title?.ToLower().Contains(searchLower) ?? false;
                var cleanContent = StripHtml(e.Content);
                var contentMatch = cleanContent.ToLower().Contains(searchLower);
                return titleMatch || contentMatch;
            }).ToList();
        }


        // Apply mood filter
        if (!string.IsNullOrEmpty(_selectedMood))
        {
            if (Enum.TryParse<Mood>(_selectedMood, true, out var selectedMoodEnum))
            {
                filtered = filtered.Where(e => e.Mood == selectedMoodEnum).ToList();
            }
        }

        // Apply secondary mood filter
        if (!string.IsNullOrEmpty(_selectedSecondaryMood))
        {
            filtered = filtered.Where(e => e.SecondaryMood == _selectedSecondaryMood).ToList();
        }

        // Apply tag filter
        if (!string.IsNullOrEmpty(_selectedTag))
        {
            filtered = filtered.Where(e => e.Tags.Any(t => t.Equals(_selectedTag, StringComparison.OrdinalIgnoreCase))).ToList();
        }

        // Apply date range filter
        if (_startDate.HasValue || _endDate.HasValue)
        {
            filtered = filtered.Where(e =>
            {
                var entryDate = e.Date;
                var startDateOnly = _startDate.HasValue ? DateOnly.FromDateTime(_startDate.Value) : DateOnly.MinValue;
                var endDateOnly = _endDate.HasValue ? DateOnly.FromDateTime(_endDate.Value) : DateOnly.MaxValue;
                var startMatch = !_startDate.HasValue || entryDate >= startDateOnly;
                var endMatch = !_endDate.HasValue || entryDate <= endDateOnly;
                return startMatch && endMatch;
            }).ToList();
        }

        _displayEntries = filtered.OrderByDescending(e => e.Date).ToList();
        StateHasChanged();
    }

    
    /// Strips HTML tags and cleans up whitespace from content
    
    private string StripHtml(string content)
    {
        if (string.IsNullOrEmpty(content)) return "";
        
        // Remove all HTML tags
        var text = Regex.Replace(content, "<[^>]*>", " ");
        
        // Replace multiple spaces with single space
        text = Regex.Replace(text, @"\s+", " ");
        
        return text.Trim();
    }

    
    /// Gets a clean text preview, stripping HTML tags
    
    private string GetPreview(string content)
    {
        if (string.IsNullOrEmpty(content)) return "";
        
        // Strip HTML tags first
        var cleanText = StripHtml(content);
        
        if (string.IsNullOrEmpty(cleanText)) return "[No content]";
        
        // Return preview (max 150 chars)
        if (cleanText.Length > 150)
            return cleanText.Substring(0, 150) + "...";
        
        return cleanText;
    }

    
    /// Calculates actual word count excluding HTML tags
    
    private int GetWordCount(string content)
    {
        if (string.IsNullOrEmpty(content)) return 0;
        
        // Strip HTML tags first
        var cleanText = StripHtml(content);
        
        if (string.IsNullOrEmpty(cleanText)) return 0;
        
        return cleanText.Split(new[] { ' ', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries).Length;
    }

    private void ToggleDatePicker()
    {
        _showDatePicker = !_showDatePicker;
    }

    private async Task ClearSearch()
    {
        _searchTerm = "";
        await ApplyFilters();
    }

    private async Task ResetFilters()
    {
        _selectedMood = "";
        _selectedSecondaryMood = "";
        _selectedTag = "";
        _startDate = null;
        _endDate = null;
        _searchTerm = "";
        _showDatePicker = false;
        await ApplyFilters();
    }

    private string GetTimeAgo(DateTime dateTime)
    {
        var timeSpan = DateTime.Now - dateTime;
        if (timeSpan.TotalSeconds < 60) return "Just now";
        if (timeSpan.TotalMinutes < 60) return $"{(int)timeSpan.TotalMinutes}m ago";
        if (timeSpan.TotalHours < 24) return $"{(int)timeSpan.TotalHours}h ago";
        if (timeSpan.TotalDays < 7) return $"{(int)timeSpan.TotalDays}d ago";
        return dateTime.ToString("MMM dd");
    }

    
    /// Navigate to the Today page with the selected date to view/edit the entry
    
    private void ViewEntry(DateOnly entryDate)
    {
        Navigation.NavigateTo($"/today?date={entryDate:yyyy-MM-dd}");
    }
}

<style>
.page-stack {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
}

.timeline-header {
    padding: 1.5rem 0;
}

.muted {
    opacity: 0.7;
}

.filters-paper {
    padding: 2rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

:deep(.mud-dark .filters-paper) {
    background-color: #424242 !important;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3) !important;
}

.filter-label {
    display: inline-block;
    padding-bottom: 0.25rem;
    border-bottom: 2px solid rgba(25, 118, 210, 0.3);
}

.entries-grid {
    margin: 2rem 0;
}

.entry-card {
    padding: 1.75rem;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 320px;
}

.entry-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

:deep(.mud-dark .entry-card) {
    background-color: #424242 !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
}

:deep(.mud-dark .entry-card:hover) {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4) !important;
}

.entry-snippet {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    max-height: 72px;
    line-height: 1.5;
}

.footer-section {
    padding-top: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.08);
}

:deep(.mud-dark .footer-section) {
    border-top-color: rgba(255, 255, 255, 0.12) !important;
}

.open-button {
    font-weight: 600 !important;
    transition: all 0.2s ease !important;
}

.open-button:hover {
    transform: translateX(2px);
}

.truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.my-2 {
    margin: 0.5rem 0;
}
</style>
