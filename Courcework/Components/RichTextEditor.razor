@using System.Collections.Generic
@inject IJSRuntime JS

<div class="rich-editor-container">
    <h3>Write Content</h3>
    <div id="editor" style="height: 200px; background: white;"></div>
    <button @onclick="Save">Save</button>
    
    @if (!string.IsNullOrEmpty(HtmlContent))
    {
        <div class="preview-section">
            <h4>Preview</h4>
            <div class="content-preview">
                @((MarkupString)HtmlContent)
            </div>
        </div>
    }
</div>

@code {
    private string HtmlContent = "";

    [Parameter]
    public string Content { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<string> ContentChanged { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                // Initialize Quill editor
                await JS.InvokeVoidAsync("initQuill", "editor");
                System.Diagnostics.Debug.WriteLine("Quill editor initialized");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Error: {ex.Message}");
            }
        }
    }

    private async Task Save()
    {
        try
        {
            // Get HTML from Quill editor
            HtmlContent = await JS.InvokeAsync<string>("getQuillHtml");
            Content = HtmlContent;
            await ContentChanged.InvokeAsync(Content);
            System.Diagnostics.Debug.WriteLine($"Saved content: {HtmlContent}");
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($"Error saving: {ex.Message}");
        }
    }
}

<style>
.rich-editor-container {
    width: 100%;
    padding: 1rem;
}

.preview-section {
    margin-top: 1rem;
    padding: 1rem;
    background-color: #f5f5f5;
    border-radius: 4px;
}

.preview-section h4 {
    margin: 0 0 0.5rem 0;
    font-size: 0.875rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.content-preview {
    background: white;
    padding: 1rem;
    border-radius: 4px;
    border: 1px solid #e0e0e0;
    line-height: 1.6;
    color: #333;
    word-break: break-word;
}

.content-preview :deep(p) {
    margin: 0.5rem 0;
}

.content-preview :deep(strong) {
    font-weight: 600;
}

.content-preview :deep(em) {
    font-style: italic;
}

.content-preview :deep(ol),
.content-preview :deep(ul) {
    margin: 0.5rem 0;
    padding-left: 2rem;
}

/* Quill Snow Theme Customization */
:deep(.ql-toolbar.ql-snow) {
    border: 1px solid #ccc;
    border-radius: 4px 4px 0 0;
}

:deep(.ql-container.ql-snow) {
    border: 1px solid #ccc;
    border-radius: 0 0 4px 4px;
}

:deep(.ql-editor) {
    min-height: 200px;
    font-family: "Poppins", sans-serif;
}
</style>
